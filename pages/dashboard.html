<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Mixar</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Discord Popup Overlay */
        .discord-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        .discord-popup {
            background: rgba(10, 10, 10, 0.95);
            border-radius: 20px;
            padding: 40px;
            max-width: 420px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 192, 199, 0.15);
            backdrop-filter: blur(20px);
            transform: scale(0.9);
            animation: popIn 0.3s ease 0.1s forwards;
        }
        @keyframes popIn {
            to { transform: scale(1); }
        }
        .discord-popup h2 {
            font-size: 24px;
            font-weight: 600;
            margin: 0 0 12px 0;
            background: linear-gradient(135deg, #00C0C7 0%, #85C449 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .discord-popup p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            line-height: 1.6;
            margin: 0 0 28px 0;
        }
        .discord-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        .btn-discord {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #00C0C7 0%, #85C449 100%);
            color: #0a0a0a;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        .btn-discord:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 192, 199, 0.3);
        }
        .btn-discord svg {
            width: 20px;
            height: 20px;
        }
        .btn-dismiss {
            padding: 12px 24px;
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0, 192, 199, 0.15);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-dismiss:hover {
            background: rgba(0, 192, 199, 0.05);
            border-color: rgba(0, 192, 199, 0.3);
            color: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body>
    <!-- Discord Community Popup (hidden by default, shown only on first visit) -->
    <div class="discord-overlay" id="discordOverlay" style="display: none;">
        <div class="discord-popup">
            <h2>Welcome Aboard</h2>
            <p>We're excited to have you. In case you haven't already, please join our Discord to connect with other creators, get help, and stay updated on the latest features.</p>
            <div class="discord-buttons">
                <a href="https://discord.com/invite/P3dUwj7KzW" target="_blank" class="btn-discord" onclick="dismissDiscordPopup()">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/>
                    </svg>
                    Join Discord
                </a>
                <button class="btn-dismiss" onclick="dismissDiscordPopup()">Maybe Later</button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav">
        <a href="../index.html" class="nav-brand">
            <img src="../assets/Logo-Primary_light.png" alt="Mixar" class="brand-logo">
        </a>
        <div class="user-menu">
            <a href="admin.html" class="nav-link admin-link" id="adminLink" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                Admin
            </a>
            <div class="user-credits" id="userCredits">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6v6l4 2"/>
                </svg>
                <span id="creditsCount">--</span> credits
            </div>
            <div class="user-avatar" id="userAvatar">--</div>
            <button class="nav-link" onclick="auth.logout()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                Logout
            </button>
        </div>
    </nav>

    <!-- Dashboard Content -->
    <main class="dashboard-container">
        <div class="dashboard-content">
            <!-- Loading State -->
            <div class="loading" id="loadingState">
                <div class="spinner"></div>
            </div>

            <!-- Dashboard Content (hidden initially) -->
            <div id="dashboardContent" style="display: none;">
                <!-- Header -->
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Welcome, <span id="userName">User</span>!</h1>
                    <p class="dashboard-subtitle">Manage your credits and view your usage history</p>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 6v6l4 2"/>
                                </svg>
                            </div>
                            <span class="stat-badge">Available</span>
                        </div>
                        <div class="stat-value" id="availableCredits">--</div>
                        <div class="stat-label">Credits Balance</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                    <path d="M2 17l10 5 10-5"/>
                                    <path d="M2 12l10 5 10-5"/>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value" id="totalGenerations">--</div>
                        <div class="stat-label">Total Generations</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                    <path d="M21 15l-5-5L5 21"/>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value" id="imagesGenerated">--</div>
                        <div class="stat-label">Images Generated</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value" id="modelsGenerated">--</div>
                        <div class="stat-label">3D Models Generated</div>
                    </div>
                </div>

                <!-- Recent Usage Section (hidden) -->
                <div class="section" style="display: none;">
                    <div class="section-header">
                        <h2 class="section-title">Recent Activity</h2>
                    </div>

                    <div class="usage-table-container">
                        <table class="usage-table" id="usageTable">
                            <thead>
                                <tr>
                                    <th>Activity</th>
                                    <th>Credits Used</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="usageTableBody">
                                <!-- Data will be populated here -->
                            </tbody>
                        </table>

                        <!-- Empty State -->
                        <div class="empty-state" id="emptyState" style="display: none;">
                            <div class="empty-icon">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 6v6l4 2"/>
                                </svg>
                            </div>
                            <h3 class="empty-title">No activity yet</h3>
                            <p class="empty-message">Start creating with Mixar to see your usage history here.</p>
                        </div>
                    </div>
                </div>

                <!-- Downloads Section -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Download Mixar</h2>
                    </div>

                    <div class="downloads-grid">
                        <!-- Windows Card -->
                        <div class="download-card">
                            <div class="download-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M0 3.449L9.75 2.1v9.451H0m10.949-9.602L24 0v11.4H10.949M0 12.6h9.75v9.451L0 20.699M10.949 12.6H24V24l-12.9-1.801"/>
                                </svg>
                            </div>
                            <div class="download-info">
                                <h3>Mixar for Windows</h3>
                                <p>Windows 10/11</p>
                            </div>
                            <a href="https://dngk02rvvv66y.cloudfront.net/beta/Mixar_v2.0.exe" class="btn-download">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Download
                            </a>
                        </div>

                        <!-- Mac Card -->
                        <div class="download-card">
                            <div class="download-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                                </svg>
                            </div>
                            <div class="download-info">
                                <h3>Mixar for Mac</h3>
                                <p>macOS 12+</p>
                            </div>
                            <a href="https://dngk02rvvv66y.cloudfront.net/beta/Mixar_v2.0.dmg" class="btn-download">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Download
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Community Section -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Help Shape the Future</h2>
                    </div>

                    <div class="community-card">
                        <div class="community-icon">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                        </div>
                        <div class="community-content">
                            <p class="community-message">We'd love to hear your feedback and suggestions. Connect with other creators, share ideas, and learn more about AI-native workflows.</p>
                        </div>
                        <div class="community-actions">
                            <a href="https://discord.com/invite/P3dUwj7KzW" target="_blank" class="btn-community btn-discord">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/>
                                </svg>
                                Join Discord
                            </a>
                            <a href="https://calendly.com/naman-mixar/30min" target="_blank" class="btn-community btn-talk">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="16" y1="2" x2="16" y2="6"/>
                                    <line x1="8" y1="2" x2="8" y2="6"/>
                                    <line x1="3" y1="10" x2="21" y2="10"/>
                                </svg>
                                Schedule Call
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="../js/config.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        // Check authentication and initialize dashboard
        if (auth.requireAuth()) {
            initDashboard();
        }

        async function initDashboard() {
            try {
                // Fetch user data
                const user = await auth.fetchUser();

                if (!user) {
                    auth.logout();
                    return;
                }

                // Update UI with user data
                updateUserInfo(user);

                // Fetch usage data (mock for now)
                await fetchUsageData();

                // Hide loading, show content
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
            } catch (error) {
                console.error('Failed to load dashboard:', error);
                auth.logout();
            }
        }

        function updateUserInfo(user) {
            const name = user.name || user.email.split('@')[0];
            const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
            const credits = user.credits || 0;

            // Update header
            document.getElementById('userName').textContent = name.split(' ')[0];
            document.getElementById('creditsCount').textContent = credits;
            document.getElementById('userAvatar').textContent = initials;

            // Show admin link if superuser
            if (user.is_superuser) {
                document.getElementById('adminLink').style.display = 'flex';
            }

            // Update stats
            document.getElementById('availableCredits').textContent = credits;
        }

        async function fetchUsageData() {
            try {
                // Fetch real usage data from API
                const response = await auth.apiRequest('/users/user-usage-logs/');
                const result = await response.json();

                let usageData = [];
                if (result.status === 'success' && result.data) {
                    usageData = result.data.map(item => ({
                        mode: item.mode,
                        type: getModeLabel(item.mode),
                        icon: getModeIcon(item.mode),
                        credits: item.credits_used || 0,
                        date: new Date(item.created_at),
                        model: item.model_name,
                        status: 'completed'
                    }));
                }

                // Calculate stats from real data
                const totalGenerations = usageData.length;
                const imagesGenerated = usageData.filter(u => u.mode === 'ideation').length;
                const modelsGenerated = usageData.filter(u => u.mode === 'generate_3d').length;
                const agentActions = usageData.filter(u => u.mode === 'agent').length;

                document.getElementById('totalGenerations').textContent = totalGenerations;
                document.getElementById('imagesGenerated').textContent = imagesGenerated;
                document.getElementById('modelsGenerated').textContent = modelsGenerated;

                // Update table
                const tbody = document.getElementById('usageTableBody');
                const emptyState = document.getElementById('emptyState');

                if (usageData.length === 0) {
                    tbody.parentElement.style.display = 'none';
                    emptyState.style.display = 'block';
                } else {
                    emptyState.style.display = 'none';
                    tbody.parentElement.style.display = 'table';
                    tbody.innerHTML = usageData.map(item => `
                        <tr>
                            <td>
                                <div class="usage-type">
                                    <div class="usage-type-icon">
                                        ${getIcon(item.icon)}
                                    </div>
                                    <div class="usage-type-info">
                                        <span>${item.type}</span>
                                        ${item.model ? `<small class="usage-model">${item.model}</small>` : ''}
                                    </div>
                                </div>
                            </td>
                            <td class="usage-credits">${item.credits > 0 ? '-' + item.credits : '0'}</td>
                            <td class="usage-date">${formatDate(item.date)}</td>
                            <td><span class="usage-status ${item.status}">${capitalize(item.status)}</span></td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Failed to fetch usage data:', error);
                // Show empty state on error
                document.getElementById('totalGenerations').textContent = '0';
                document.getElementById('imagesGenerated').textContent = '0';
                document.getElementById('modelsGenerated').textContent = '0';
                document.getElementById('usageTableBody').parentElement.style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
            }
        }

        function getModeLabel(mode) {
            const labels = {
                'ideation': 'Image Generation',
                'texture': 'Texture Painting',
                'ask': 'AI Chat',
                'generate_3d': '3D Model Generation',
                'lookdev': 'Look Development',
                'segment': 'Mesh Segmentation',
                'agent': 'Blender Agent'
            };
            return labels[mode] || mode;
        }

        function getModeIcon(mode) {
            const icons = {
                'ideation': 'image',
                'texture': 'brush',
                'ask': 'chat',
                'generate_3d': 'cube',
                'lookdev': 'palette',
                'segment': 'scissors',
                'agent': 'robot'
            };
            return icons[mode] || 'activity';
        }

        function getIcon(type) {
            const icons = {
                image: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>',
                cube: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>',
                brush: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.06 11.9l8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08"/><path d="M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z"/></svg>',
                chat: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>',
                palette: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="13.5" cy="6.5" r="2.5"/><circle cx="17.5" cy="10.5" r="2.5"/><circle cx="8.5" cy="7.5" r="2.5"/><circle cx="6.5" cy="12.5" r="2.5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/></svg>',
                scissors: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>',
                robot: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><line x1="12" y1="7" x2="12" y2="11"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/><circle cx="8" cy="16" r="1" fill="currentColor"/><circle cx="16" cy="16" r="1" fill="currentColor"/></svg>',
                activity: '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>'
            };
            return icons[type] || icons.activity;
        }

        function formatDate(date) {
            const now = new Date();
            const diff = now - date;
            const days = Math.floor(diff / 86400000);

            if (days === 0) return 'Today';
            if (days === 1) return 'Yesterday';
            if (days < 7) return `${days} days ago`;
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Discord popup functions
        function showDiscordPopupIfNew() {
            // Only show popup if user hasn't dismissed it before
            if (!localStorage.getItem('discordPopupDismissed')) {
                document.getElementById('discordOverlay').style.display = 'flex';
            }
        }

        function dismissDiscordPopup() {
            localStorage.setItem('discordPopupDismissed', 'true');
            const overlay = document.getElementById('discordOverlay');
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 300);
        }

        // Check if popup should be shown
        showDiscordPopupIfNew();
    </script>
</body>
</html>
